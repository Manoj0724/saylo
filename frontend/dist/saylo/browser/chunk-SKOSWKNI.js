import{a as Oe,c as Pe,e as Te,j as Ee}from"./chunk-ZEBKWJDK.js";import{$ as r,A as P,C as ge,Ca as ke,D as fe,Da as te,Ea as Se,H as xe,I as s,J as E,O as N,P as y,R as C,S as _e,T,U as w,Va as ne,W as f,Wa as ie,X as Q,Xa as Me,Y as I,Ya as Ve,Z as j,Za as ze,_ as a,a as U,aa as m,b as pe,ba as M,ca as x,da as p,ea as A,fa as D,ga as F,h as b,ha as c,i as q,ia as h,ja as B,ka as Ce,l as L,la as Y,ma as Z,na as X,o as G,p as me,pa as J,qa as ve,r as H,ra as K,sa as be,ta as se,u as he,v as ue,va as ye,x as u,xa as ee,y as g,ya as le,z as v,za as we}from"./chunk-75XYQH6H.js";import{a as k,b as S,e as V}from"./chunk-2H7K6JAD.js";function W(o,d){!d?.injector&&ue(W);let e=d?.injector??me(ge),t=new pe(1),n=we(()=>{let i;try{i=o()}catch(l){le(()=>t.error(l));return}le(()=>t.next(i))},{injector:e,manualCleanup:!0});return e.get(fe).onDestroy(()=>{n.destroy(),t.complete()}),t.asObservable()}var ae=(()=>{class o{constructor(e,t){this.socket=e,this.zone=t,this.destroy$=new U,this.pc=null,this.pendingOffer=null,this.pendingOfferFrom=null,this.durationTimer=null,this.audioElement=null,this.remoteStreamRef=new MediaStream,this.callStatus=y("idle"),this.activeCall=y(null),this.incomingCall=y(null),this.localStream=y(null),this.remoteStream=y(null),this.isMuted=y(!1),this.isCameraOff=y(!1),this.callDuration=y(0),this.pendingCallerName="",this.STUN={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"}]},this.listenSocket()}startCall(e,t,n,i){return V(this,null,function*(){if(this.callStatus()!=="idle"){alert("Already in a call");return}this.hardReset(!0);try{let l=yield this.getMedia(i);this.zone.run(()=>{this.localStream.set(l),this.callStatus.set("calling")}),this.socket.initiateCall(e,t,i);let _=this.socket.on("call:initiated").subscribe(z=>V(this,[z],function*({callId:O}){_.unsubscribe(),this.zone.run(()=>{this.activeCall.set({callId:O,type:i,chatId:e,remoteUserId:t,remoteUserName:n,direction:"outgoing"}),this.callStatus.set("calling")}),this.pc=this.createPC(O,t,i),this.addTracks(l,i),yield this.makeOffer(O,t,i)}))}catch(l){console.error("[Call] Start failed:",l),this.zone.run(()=>{alert(this.mediaError(l)),this.cleanup()})}})}answerCall(){return V(this,null,function*(){let e=this.incomingCall();if(e)try{let t,n=e.type;try{t=yield this.getMedia(n)}catch(i){if(n==="video")console.warn("[Call] Camera unavailable, falling back to audio:",i.message),t=yield this.getMedia("audio"),n="audio";else throw i}this.zone.run(()=>{this.localStream.set(t),this.activeCall.set(S(k({},e),{type:n,direction:"incoming"})),this.incomingCall.set(null),this.callStatus.set("connected")}),this.socket.answerCall(e.callId),this.pc=this.createPC(e.callId,e.remoteUserId,n),this.addTracks(t,n),this.pendingOffer&&this.pendingOfferFrom&&(console.log("[WebRTC] Processing buffered offer"),yield this.processOffer(e.callId,this.pendingOffer,this.pendingOfferFrom,n),this.pendingOffer=null,this.pendingOfferFrom=null),this.startTimer()}catch(t){console.error("[Call] Answer failed:",t),this.zone.run(()=>{alert(this.mediaError(t)),this.cleanup()})}})}declineCall(){let e=this.incomingCall();e&&this.socket.declineCall(e.callId),this.cleanup()}endCall(){let e=this.activeCall();e&&this.socket.endCall(e.callId),this.cleanup()}toggleMute(){let e=this.localStream();e&&(e.getAudioTracks().forEach(t=>{t.enabled=!t.enabled}),this.isMuted.set(!this.isMuted()))}toggleCamera(){let e=this.localStream();e&&(e.getVideoTracks().forEach(t=>{t.enabled=!t.enabled}),this.isCameraOff.set(!this.isCameraOff()))}getMedia(e){return V(this,null,function*(){return navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:48e3},video:e==="video"?{width:{ideal:1280},height:{ideal:720},facingMode:"user",frameRate:{ideal:30}}:!1})})}addTracks(e,t){if(!this.pc)return;let n=e.getAudioTracks(),i=e.getVideoTracks();n.forEach(l=>{console.log("[WebRTC] Adding local audio track"),this.pc.addTrack(l,e)}),t==="video"&&i.forEach(l=>{console.log("[WebRTC] Adding local video track"),this.pc.addTrack(l,e)})}createPC(e,t,n){try{this.pc&&(this.pc.ontrack=null,this.pc.onicecandidate=null,this.pc.oniceconnectionstatechange=null,this.pc.onsignalingstatechange=null,this.pc.close())}catch{}this.pc=null,this.remoteStreamRef=new MediaStream,this.remoteStream.set(this.remoteStreamRef);let i=new RTCPeerConnection(this.STUN);return i.ontrack=l=>{let _=l.track;if(console.log("[WebRTC] Remote track:",_.kind,"| state:",_.readyState,"| streams:",l.streams.length),l.streams&&l.streams[0]){let O=l.streams[0];this.remoteStreamRef.getTracks().find(R=>R.id===_.id)||(this.remoteStreamRef.addTrack(_),console.log("[WebRTC] Added",_.kind,"to remoteStream. Total:",this.remoteStreamRef.getTracks().length)),_.onunmute=()=>{console.log("[WebRTC] Track unmuted:",_.kind),this.zone.run(()=>this.remoteStream.set(new MediaStream(this.remoteStreamRef.getTracks())))}}this.zone.run(()=>{let O=new MediaStream(this.remoteStreamRef.getTracks());this.remoteStream.set(O),console.log("[WebRTC] remoteStream updated. Tracks:",O.getTracks().map(z=>`${z.kind}(${z.readyState})`)),n==="audio"&&this.playAudio(O)})},i.onicecandidate=l=>{l.candidate&&this.socket.sendIceCandidate(e,l.candidate,t)},i.oniceconnectionstatechange=()=>{console.log("[WebRTC] ICE:",i.iceConnectionState),(i.iceConnectionState==="connected"||i.iceConnectionState==="completed")&&this.zone.run(()=>{this.callStatus.set("connected"),this.startTimer()}),i.iceConnectionState==="failed"&&this.zone.run(()=>{alert("Connection failed. Try again."),this.cleanup()})},i.onsignalingstatechange=()=>console.log("[WebRTC] Signaling:",i.signalingState),i}makeOffer(e,t,n){return V(this,null,function*(){if(!(!this.pc||this.pc.signalingState!=="stable"))try{let i=yield this.pc.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:n==="video"});yield this.pc.setLocalDescription(i),this.socket.sendOffer(e,i,t),console.log("[WebRTC] \u2705 Offer sent")}catch(i){console.error("[WebRTC] Offer error:",i)}})}processOffer(e,t,n,i){return V(this,null,function*(){if(this.pc)try{yield this.pc.setRemoteDescription(new RTCSessionDescription(t));let l=yield this.pc.createAnswer();yield this.pc.setLocalDescription(l),this.socket.sendAnswer(e,l,n),console.log("[WebRTC] \u2705 Answer sent")}catch(l){console.error("[WebRTC] processOffer error:",l)}})}playAudio(e){try{this.audioElement&&(this.audioElement.pause(),this.audioElement.srcObject=null),this.audioElement=new Audio,this.audioElement.srcObject=e,this.audioElement.volume=1,this.audioElement.play().then(()=>console.log("[Call] \u2705 Audio playing")).catch(t=>console.warn("[Call] Audio blocked:",t))}catch(t){console.error("[Call] Audio element error:",t)}}listenSocket(){this.socket.on("call:incoming").pipe(b(this.destroy$)).subscribe(({callId:e,from:t,fromName:n,chatId:i,type:l})=>{if(console.log("[Call] \u{1F4DE} INCOMING from:",n,"| type:",l),this.callStatus()!=="idle"){this.socket.declineCall(e);return}this.zone.run(()=>{this.incomingCall.set({callId:e,type:l,chatId:i,remoteUserId:t,remoteUserName:n||"Someone",direction:"incoming"}),this.callStatus.set("ringing")})}),this.socket.on("call:answered").pipe(b(this.destroy$)).subscribe(({callId:e})=>console.log("[Call] \u2705 Answered:",e)),this.socket.on("call:declined").pipe(b(this.destroy$)).subscribe(()=>this.zone.run(()=>{alert("Call was declined."),this.cleanup()})),this.socket.on("call:ended").pipe(b(this.destroy$)).subscribe(()=>this.zone.run(()=>this.cleanup())),this.socket.on("call:user-offline").pipe(b(this.destroy$)).subscribe(()=>this.zone.run(()=>{alert("User is offline."),this.cleanup()})),this.socket.on("webrtc:offer").pipe(b(this.destroy$)).subscribe(i=>V(this,[i],function*({callId:e,offer:t,from:n}){console.log("[WebRTC] \u{1F4E8} Offer received | PC:",this.pc?.signalingState||"no PC");let l=this.activeCall()?.type||this.incomingCall()?.type||"audio";this.pc&&this.pc.signalingState==="stable"?yield this.processOffer(e,t,n,l):(this.pendingOffer=t,this.pendingOfferFrom=n)})),this.socket.on("webrtc:answer").pipe(b(this.destroy$)).subscribe(t=>V(this,[t],function*({answer:e}){console.log("[WebRTC] \u{1F4E8} Answer received | PC:",this.pc?.signalingState);try{this.pc?.signalingState==="have-local-offer"&&(yield this.pc.setRemoteDescription(new RTCSessionDescription(e)),console.log("[WebRTC] \u2705 Remote description set"))}catch(n){console.error("[WebRTC] Set answer error:",n)}})),this.socket.on("webrtc:ice-candidate").pipe(b(this.destroy$)).subscribe(t=>V(this,[t],function*({candidate:e}){try{this.pc?.remoteDescription&&(yield this.pc.addIceCandidate(new RTCIceCandidate(e)))}catch(n){console.warn("[WebRTC] ICE warn:",n)}}))}startTimer(){this.durationTimer||(this.callDuration.set(0),this.durationTimer=setInterval(()=>this.zone.run(()=>this.callDuration.update(e=>e+1)),1e3))}hardReset(e){try{this.pc&&(this.pc.ontrack=null,this.pc.onicecandidate=null,this.pc.oniceconnectionstatechange=null,this.pc.onsignalingstatechange=null,this.pc.close())}catch{}if(this.pc=null,e){try{this.localStream()?.getTracks().forEach(t=>t.stop())}catch{}try{this.remoteStream()?.getTracks().forEach(t=>t.stop())}catch{}this.localStream.set(null),this.remoteStream.set(null),this.remoteStreamRef=new MediaStream}try{this.audioElement&&(this.audioElement.pause(),this.audioElement.srcObject=null,this.audioElement=null)}catch{}}cleanup(){clearInterval(this.durationTimer),this.durationTimer=null,this.hardReset(!0),this.pendingOffer=null,this.pendingOfferFrom=null,this.activeCall.set(null),this.incomingCall.set(null),this.callStatus.set("idle"),this.callDuration.set(0),this.isMuted.set(!1),this.isCameraOff.set(!1)}mediaError(e){return e.name==="NotAllowedError"?"Permission denied. Allow camera/mic in browser settings.":e.name==="NotFoundError"?"No camera/microphone found on this device.":"Could not access camera/mic. Close other apps using it."}destroy(){this.destroy$.next(),this.destroy$.complete(),this.cleanup()}static{this.\u0275fac=function(t){return new(t||o)(G(ie),G(N))}}static{this.\u0275prov=L({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Re=["localVid"],$e=["remoteVid"];function Ue(o,d){if(o&1){let e=M();a(0,"div",2)(1,"div",4),m(2,"div",5)(3,"div",6)(4,"div",7),a(5,"div",8),c(6),r(),a(7,"h2",9),c(8),r(),a(9,"p",10),c(10),r(),a(11,"div",11),m(12,"span")(13,"span")(14,"span"),r(),a(15,"div",12)(16,"button",13),x("click",function(){u(e);let n=p();return g(n.callSvc.declineCall())}),v(),a(17,"svg",14),m(18,"line",15)(19,"path",16),r()(),P(),a(20,"button",17),x("click",function(){u(e);let n=p();return g(n.callSvc.answerCall())}),v(),a(21,"svg",14),m(22,"path",18),r()()()()()}if(o&2){let e=d,t=p();s(5),T("background",t.grad(e.remoteUserName)),s(),h(t.ini(e.remoteUserName)),s(2),h(e.remoteUserName),s(2),h(e.type==="video"?"\u{1F4F9} Incoming Video Call":"\u{1F4DE} Incoming Audio Call")}}function Ne(o,d){if(o&1){let e=M();a(0,"div",2)(1,"div",19)(2,"div",8),c(3),r(),a(4,"h2",9),c(5),r(),a(6,"p",10),c(7,"Calling..."),r(),a(8,"div",11),m(9,"span")(10,"span")(11,"span"),r(),a(12,"button",20),x("click",function(){u(e);let n=p();return g(n.callSvc.endCall())}),v(),a(13,"svg",21),m(14,"line",15)(15,"path",16),r(),c(16," Cancel "),r()()()}if(o&2){let e,t,n,i=p();s(2),T("background",i.grad(((e=i.callSvc.activeCall())==null?null:e.remoteUserName)||"")),s(),h(i.ini(((t=i.callSvc.activeCall())==null?null:t.remoteUserName)||"")),s(2),h((n=i.callSvc.activeCall())==null?null:n.remoteUserName)}}function Be(o,d){if(o&1&&m(0,"div",36),o&2){let e=d.$implicit;T("animation-delay",e*.09+"s")}}function Ge(o,d){o&1&&(v(),a(0,"svg",29),m(1,"line",15)(2,"path",37)(3,"path",38)(4,"line",39),r())}function We(o,d){o&1&&(v(),a(0,"svg",29),m(1,"path",40)(2,"path",41)(3,"line",39),r())}function qe(o,d){if(o&1){let e=M();a(0,"div",2)(1,"div",22)(2,"div",23),I(3,Be,1,2,"div",24,Q),r(),a(5,"div",25),c(6),r(),a(7,"h2",9),c(8),r(),a(9,"p",26),c(10),r(),a(11,"div",27)(12,"button",28),x("click",function(){u(e);let n=p();return g(n.callSvc.toggleMute())}),C(13,Ge,5,0,":svg:svg",29)(14,We,4,0),a(15,"span"),c(16),r()(),a(17,"button",30),x("click",function(){u(e);let n=p();return g(n.callSvc.endCall())}),v(),a(18,"svg",31),m(19,"line",15)(20,"path",16),r(),P(),a(21,"span"),c(22,"End"),r()(),a(23,"button",32),v(),a(24,"svg",29),m(25,"polygon",33)(26,"path",34)(27,"path",35),r(),P(),a(28,"span"),c(29,"Speaker"),r()()()()()}if(o&2){let e=p();s(2),w("muted",e.callSvc.isMuted()),s(),j(e.bars),s(2),T("background",e.grad(e.callSvc.activeCall().remoteUserName)),s(),h(e.ini(e.callSvc.activeCall().remoteUserName)),s(2),h(e.callSvc.activeCall().remoteUserName),s(2),h(e.fmt(e.callSvc.callDuration())),s(2),w("on",e.callSvc.isMuted()),s(),f(13,e.callSvc.isMuted()?13:14),s(3),h(e.callSvc.isMuted()?"Unmute":"Mute")}}function Le(o,d){if(o&1&&(a(0,"div",43)(1,"div",59),c(2),r(),a(3,"p",60),c(4),r(),a(5,"p",61),c(6,"Connecting video..."),r()()),o&2){let e=p(2);s(),T("background",e.grad(e.callSvc.activeCall().remoteUserName)),s(),h(e.ini(e.callSvc.activeCall().remoteUserName)),s(2),h(e.callSvc.activeCall().remoteUserName)}}function He(o,d){o&1&&(a(0,"div",46),v(),a(1,"svg",62),m(2,"line",15)(3,"path",63),r()())}function Qe(o,d){o&1&&(v(),a(0,"svg",29),m(1,"line",15)(2,"path",37),r())}function Ye(o,d){o&1&&(v(),a(0,"svg",29),m(1,"path",40)(2,"path",41),r())}function Ze(o,d){o&1&&(v(),a(0,"svg",29),m(1,"line",15)(2,"path",63),r())}function Xe(o,d){o&1&&(v(),a(0,"svg",29),m(1,"path",64),r())}function Je(o,d){if(o&1){let e=M();a(0,"div",3),m(1,"video",42,0),C(3,Le,7,4,"div",43),a(4,"div",44),m(5,"video",45,1),C(7,He,4,0,"div",46),r(),a(8,"div",47)(9,"div")(10,"div",48),c(11),r(),a(12,"div",49),c(13),r()(),a(14,"div",50),m(15,"div",51)(16,"div",52)(17,"div",53)(18,"div",54),r()(),a(19,"div",55)(20,"button",56),x("click",function(){u(e);let n=p();return g(n.callSvc.toggleMute())}),C(21,Qe,3,0,":svg:svg",29)(22,Ye,3,0),r(),a(23,"button",57),x("click",function(){u(e);let n=p();return g(n.callSvc.endCall())}),v(),a(24,"svg",58),m(25,"line",15)(26,"path",16),r()(),P(),a(27,"button",56),x("click",function(){u(e);let n=p();return g(n.callSvc.toggleCamera())}),C(28,Ze,3,0,":svg:svg",29)(29,Xe,2,0),r()()()}if(o&2){let e=p();s(3),f(3,e.remoteHasVideo?-1:3),s(),w("cam-off",e.callSvc.isCameraOff()),s(3),f(7,e.callSvc.isCameraOff()?7:-1),s(4),h(e.callSvc.activeCall().remoteUserName),s(2),h(e.fmt(e.callSvc.callDuration())),s(7),w("off",e.callSvc.isMuted()),s(),f(21,e.callSvc.isMuted()?21:22),s(6),w("off",e.callSvc.isCameraOff()),s(),f(28,e.callSvc.isCameraOff()?28:29)}}var je=(()=>{class o{constructor(e,t,n){this.callSvc=e,this.zone=t,this.cdr=n,this.destroy$=new U,this.ringInterval=null,this.audioCtx=null,this.remoteHasVideo=!1,this.bars=Array.from({length:22},(i,l)=>l),W(e.callStatus).pipe(b(this.destroy$)).subscribe(i=>{i==="ringing"?this.startRing():this.stopRing()}),W(e.localStream).pipe(b(this.destroy$)).subscribe(i=>{this.tryAttach(this.localVid,i,"local"),setTimeout(()=>this.tryAttach(this.localVid,i,"local"),300)}),W(e.remoteStream).pipe(b(this.destroy$)).subscribe(i=>{i&&(console.log("[CallUI] Remote stream signal fired, tracks:",i.getTracks().map(l=>`${l.kind}(${l.readyState})`)),this.remoteHasVideo=i.getVideoTracks().some(l=>l.readyState==="live"),this.cdr.detectChanges(),this.tryAttach(this.remoteVid,i,"remote"),setTimeout(()=>this.tryAttach(this.remoteVid,i,"remote"),200),setTimeout(()=>this.tryAttach(this.remoteVid,i,"remote"),600),setTimeout(()=>this.tryAttach(this.remoteVid,i,"remote"),1200),setTimeout(()=>this.tryAttach(this.remoteVid,i,"remote"),2500))})}ngAfterViewChecked(){let e=this.callSvc.localStream(),t=this.callSvc.remoteStream();e&&this.tryAttach(this.localVid,e,"local"),t&&this.tryAttach(this.remoteVid,t,"remote")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.stopRing()}tryAttach(e,t,n){if(!e?.nativeElement||!t)return;let i=e.nativeElement;if(i.srcObject!==t&&(console.log(`[CallUI] Attaching ${n} stream:`,t.getTracks().map(l=>`${l.kind}(${l.readyState})`).join(", ")),i.srcObject=t),i.paused&&i.play().catch(l=>{l.name!=="AbortError"&&console.warn(`[CallUI] ${n} play():`,l.message)}),n==="remote"){let l=t.getVideoTracks().some(_=>_.readyState==="live");this.remoteHasVideo!==l&&(this.remoteHasVideo=l,this.cdr.detectChanges())}}startRing(){this.stopRing();try{this.audioCtx=new AudioContext;let e=()=>{if(!this.audioCtx)return;let t=this.audioCtx.currentTime,n=this.audioCtx.createOscillator(),i=this.audioCtx.createGain();n.connect(i),i.connect(this.audioCtx.destination),n.frequency.setValueAtTime(440,t),n.frequency.setValueAtTime(490,t+.35),n.frequency.setValueAtTime(440,t+.7),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.4,t+.05),i.gain.setValueAtTime(.4,t+.95),i.gain.exponentialRampToValueAtTime(.001,t+1.1),n.start(t),n.stop(t+1.15)};e(),this.ringInterval=setInterval(e,2200)}catch(e){console.warn("[Ring]",e)}}stopRing(){clearInterval(this.ringInterval),this.ringInterval=null;try{this.audioCtx?.close()}catch{}this.audioCtx=null}fmt(e){return`${String(Math.floor(e/60)).padStart(2,"0")}:${String(e%60).padStart(2,"0")}`}ini(e){return e?e.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2):"?"}grad(e){let t=["linear-gradient(135deg,#6C63FF,#00D4FF)","linear-gradient(135deg,#FF6B9D,#FFB800)","linear-gradient(135deg,#00E5A0,#00D4FF)","linear-gradient(135deg,#FFB800,#FF6B9D)","linear-gradient(135deg,#8B5CF6,#EC4899)"],n=0;for(let i of e||"")n=i.charCodeAt(0)+((n<<5)-n);return t[Math.abs(n)%t.length]}static{this.\u0275fac=function(t){return new(t||o)(E(ae),E(N),E(ye))}}static{this.\u0275cmp=H({type:o,selectors:[["app-call"]],viewQuery:function(t,n){if(t&1&&(A(Re,5),A($e,5)),t&2){let i;D(i=F())&&(n.localVid=i.first),D(i=F())&&(n.remoteVid=i.first)}},standalone:!0,features:[J],decls:4,vars:4,consts:[["remoteVid",""],["localVid",""],[1,"overlay"],[1,"video-shell"],[1,"ring-card"],[1,"rp","rp1"],[1,"rp","rp2"],[1,"rp","rp3"],[1,"call-av"],[1,"call-name"],[1,"call-sub"],[1,"dots"],[1,"ring-btns"],[1,"rb","red",3,"click"],["width","26","height","26","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2.5"],["x1","1","y1","1","x2","23","y2","23"],["stroke-linecap","round","d","M16.5 12.5c-.83-.83-1.71-1.5-2.5-1.5h-4c-.79 0-2.09.67-2.83 1.41L4.5 15.08"],[1,"rb","green",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"],[1,"center-card"],[1,"end-pill",3,"click"],["width","18","height","18","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2.5"],[1,"audio-card"],[1,"wave-wrap"],[1,"wb",3,"animation-delay"],[1,"call-av","large"],[1,"call-timer"],[1,"audio-ctrls"],[1,"ac",3,"click"],["width","20","height","20","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2"],[1,"ac","end",3,"click"],["width","22","height","22","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2.5"],[1,"ac"],["points","11 5 6 9 2 9 2 15 6 15 11 19 11 5"],["d","M15.54 8.46a5 5 0 010 7.07"],["d","M19.07 4.93a10 10 0 010 14.14"],[1,"wb"],["d","M9 9v3a3 3 0 005.12 2.12M15 9.34V4a3 3 0 00-5.94-.6"],["d","M17 16.95A7 7 0 015 12v-2m14 0v2a7 7 0 01-.11 1.23"],["x1","12","y1","19","x2","12","y2","23"],["d","M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"],["d","M19 10v2a7 7 0 01-14 0v-2"],["autoplay","","playsinline","",1,"remote-vid"],[1,"remote-blank"],[1,"local-pip"],["autoplay","","playsinline","","muted","",1,"local-vid"],[1,"pip-off"],[1,"vid-top"],[1,"vid-name"],[1,"vid-dur"],[1,"sig"],[1,"sb","s1"],[1,"sb","s2"],[1,"sb","s3"],[1,"sb","s4"],[1,"vid-ctrls"],[1,"vc",3,"click"],[1,"vc","end-vid",3,"click"],["width","24","height","24","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2.5"],[1,"call-av","xlarge"],[1,"rb-name"],[1,"rb-sub"],["width","24","height","24","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2"],["d","M21 21H3a2 2 0 01-2-2V8a2 2 0 012-2h3m3-3h6l2 3h4a2 2 0 012 2v9.34"],["d","M15 10l4.553-2.276A1 1 0 0121 8.723v6.554a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"]],template:function(t,n){if(t&1&&C(0,Ue,23,5,"div",2)(1,Ne,17,4,"div",2)(2,qe,30,11,"div",2)(3,Je,30,12,"div",3),t&2){let i,l,_;f(0,(i=n.callSvc.callStatus()==="ringing"&&n.callSvc.incomingCall())?0:-1,i),s(),f(1,n.callSvc.callStatus()==="calling"?1:-1),s(),f(2,n.callSvc.callStatus()==="connected"&&((l=n.callSvc.activeCall())==null?null:l.type)==="audio"?2:-1),s(),f(3,n.callSvc.callStatus()==="connected"&&((_=n.callSvc.activeCall())==null?null:_.type)==="video"?3:-1)}},dependencies:[te],styles:[".overlay[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:#060910f0;-webkit-backdrop-filter:blur(28px);backdrop-filter:blur(28px);animation:_ngcontent-%COMP%_fadeIn .2s ease}.ring-card[_ngcontent-%COMP%]{position:relative;width:300px;padding:48px 28px 38px;background:var(--bg-surface);border:1px solid var(--border-subtle);border-radius:28px;box-shadow:0 32px 80px #000000b3,0 0 60px #6c63ff2e;display:flex;flex-direction:column;align-items:center;gap:14px;text-align:center;overflow:hidden}.rp[_ngcontent-%COMP%]{position:absolute;border-radius:50%;border:1px solid rgba(108,99,255,.2);top:50%;left:50%;pointer-events:none;animation:_ngcontent-%COMP%_rpulse 2.5s ease-out infinite}.rp1[_ngcontent-%COMP%]{width:200px;height:200px;animation-delay:0s}.rp2[_ngcontent-%COMP%]{width:290px;height:290px;animation-delay:.6s}.rp3[_ngcontent-%COMP%]{width:380px;height:380px;animation-delay:1.2s}@keyframes _ngcontent-%COMP%_rpulse{0%{opacity:.8;transform:translate(-50%,-50%) scale(.6)}to{opacity:0;transform:translate(-50%,-50%) scale(1.2)}}.call-av[_ngcontent-%COMP%]{position:relative;z-index:1;width:84px;height:84px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-weight:800;font-size:30px;color:#fff;box-shadow:0 8px 32px #6c63ff59;flex-shrink:0}.call-av.large[_ngcontent-%COMP%]{width:108px;height:108px;font-size:38px}.call-av.xlarge[_ngcontent-%COMP%]{width:136px;height:136px;font-size:50px}.call-name[_ngcontent-%COMP%]{font-family:var(--font-display);font-size:21px;font-weight:700;position:relative;z-index:1;margin:0}.call-sub[_ngcontent-%COMP%]{font-size:13px;color:var(--text-muted);position:relative;z-index:1;margin:0}.dots[_ngcontent-%COMP%]{display:flex;gap:5px;position:relative;z-index:1}.dots[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:6px;height:6px;border-radius:50%;background:var(--accent-primary);animation:_ngcontent-%COMP%_bounce 1.2s ease-in-out infinite}.dots[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.dots[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(3){animation-delay:.4s}@keyframes _ngcontent-%COMP%_bounce{0%,80%,to{transform:translateY(0);opacity:.4}40%{transform:translateY(-7px);opacity:1}}.ring-btns[_ngcontent-%COMP%]{display:flex;gap:26px;position:relative;z-index:1}.rb[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:none;cursor:pointer;transition:all .2s cubic-bezier(.34,1.56,.64,1)}.rb.red[_ngcontent-%COMP%]{background:#ff6b6b26;color:#ff6b6b;border:1px solid rgba(255,107,107,.3)}.rb.red[_ngcontent-%COMP%]:hover{background:#ff6b6b;color:#fff;transform:scale(1.12)}.rb.green[_ngcontent-%COMP%]{background:#00e5a026;color:#00e5a0;border:1px solid rgba(0,229,160,.3);animation:_ngcontent-%COMP%_gpulse 1.3s ease infinite}.rb.green[_ngcontent-%COMP%]:hover{background:#00e5a0;color:#fff;transform:scale(1.12)}@keyframes _ngcontent-%COMP%_gpulse{0%,to{box-shadow:0 0 #00e5a066}50%{box-shadow:0 0 0 14px #00e5a000}}.center-card[_ngcontent-%COMP%]{width:280px;padding:44px 28px 36px;background:var(--bg-surface);border:1px solid var(--border-subtle);border-radius:28px;display:flex;flex-direction:column;align-items:center;gap:14px;text-align:center}.end-pill[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 24px;background:#ff6b6b1f;color:#ff6b6b;border:1px solid rgba(255,107,107,.25);border-radius:30px;cursor:pointer;font-family:var(--font-body);font-size:13.5px;font-weight:600;transition:all .2s;margin-top:6px}.end-pill[_ngcontent-%COMP%]:hover{background:#ff6b6b;color:#fff}.audio-card[_ngcontent-%COMP%]{position:relative;width:320px;padding:52px 28px 40px;background:var(--bg-surface);border:1px solid var(--border-subtle);border-radius:28px;box-shadow:0 32px 80px #000000a6;display:flex;flex-direction:column;align-items:center;gap:18px;text-align:center;overflow:hidden}.wave-wrap[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;display:flex;align-items:flex-end;justify-content:center;gap:3px;padding:0 18px;height:60px;opacity:.13;pointer-events:none}.wb[_ngcontent-%COMP%]{width:3px;min-height:4px;background:var(--accent-primary);border-radius:2px;animation:_ngcontent-%COMP%_wave .9s ease-in-out infinite alternate;height:28px}.wave-wrap.muted[_ngcontent-%COMP%]   .wb[_ngcontent-%COMP%]{animation:none!important;height:4px!important}@keyframes _ngcontent-%COMP%_wave{0%{transform:scaleY(.2)}to{transform:scaleY(1)}}.call-timer[_ngcontent-%COMP%]{font-family:var(--font-display);font-size:34px;font-weight:700;color:#00e5a0;letter-spacing:2px;margin:0}.audio-ctrls[_ngcontent-%COMP%]{display:flex;gap:14px;align-items:center;position:relative;z-index:1}.ac[_ngcontent-%COMP%]{width:58px;height:72px;border-radius:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:5px;background:var(--bg-elevated);border:1px solid var(--border-subtle);cursor:pointer;color:var(--text-secondary);font-size:10px;font-weight:600;transition:all .18s}.ac[_ngcontent-%COMP%]:hover{background:var(--bg-hover);color:var(--text-primary)}.ac.on[_ngcontent-%COMP%]{background:#6c63ff26;color:var(--accent-primary);border-color:#6c63ff4d}.ac.end[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;background:#ff6b6b26;color:#ff6b6b;border-color:#ff6b6b4d}.ac.end[_ngcontent-%COMP%]:hover{background:#ff6b6b;color:#fff;transform:scale(1.08)}.video-shell[_ngcontent-%COMP%]{position:fixed;inset:0;z-index:9999;background:#000;animation:_ngcontent-%COMP%_fadeIn .2s ease}.remote-vid[_ngcontent-%COMP%]{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}.remote-blank[_ngcontent-%COMP%]{position:absolute;inset:0;background:linear-gradient(135deg,#0d1117,#0f172a);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px}.rb-name[_ngcontent-%COMP%]{font-family:var(--font-display);font-size:22px;font-weight:700;color:#fff;margin:0}.rb-sub[_ngcontent-%COMP%]{font-size:13px;color:#fff6;margin:0}.local-pip[_ngcontent-%COMP%]{position:absolute;bottom:100px;right:18px;width:156px;height:118px;border-radius:16px;overflow:hidden;border:2px solid rgba(255,255,255,.18);box-shadow:0 8px 32px #0000008c;background:#1a1a2e;z-index:10}.local-vid[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;transform:scaleX(-1)}.pip-off[_ngcontent-%COMP%]{position:absolute;inset:0;background:var(--bg-elevated);display:flex;align-items:center;justify-content:center;color:var(--text-muted)}.vid-top[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;padding:22px 24px;background:linear-gradient(to bottom,rgba(0,0,0,.8),transparent);display:flex;align-items:flex-start;justify-content:space-between;z-index:10}.vid-name[_ngcontent-%COMP%]{font-family:var(--font-display);font-size:19px;font-weight:700;color:#fff}.vid-dur[_ngcontent-%COMP%]{font-size:13px;color:#fff9;margin-top:2px}.sig[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:2px;padding-top:4px}.sb[_ngcontent-%COMP%]{width:4px;border-radius:2px;background:#00e5a0;opacity:.9}.s1[_ngcontent-%COMP%]{height:5px}.s2[_ngcontent-%COMP%]{height:9px}.s3[_ngcontent-%COMP%]{height:13px}.s4[_ngcontent-%COMP%]{height:18px}.vid-ctrls[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;padding:24px 24px 32px;background:linear-gradient(to top,rgba(0,0,0,.85),transparent);display:flex;justify-content:center;gap:18px;align-items:center;z-index:10}.vc[_ngcontent-%COMP%]{width:54px;height:54px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#ffffff26;border:1px solid rgba(255,255,255,.2);color:#fff;cursor:pointer;transition:all .18s;-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px)}.vc[_ngcontent-%COMP%]:hover{background:#ffffff40;transform:scale(1.08)}.vc.off[_ngcontent-%COMP%]{background:#ff6b6b4d;border-color:#ff6b6b80;color:#ff6b6b}.end-vid[_ngcontent-%COMP%]{width:62px!important;height:62px!important;background:#ff6b6b!important;border-color:#ff6b6b!important;box-shadow:0 4px 24px #ff6b6b80}.end-vid[_ngcontent-%COMP%]:hover{transform:scale(1.12)!important}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}"]})}}return o})();var Ae=(()=>{class o{transform(e){if(!e)return"";let t=new Date,n=new Date(e),i=Math.floor((t.getTime()-n.getTime())/1e3);return i<60?"now":i<3600?`${Math.floor(i/60)}m`:i<86400?`${Math.floor(i/3600)}h`:i<604800?`${Math.floor(i/86400)}d`:n.toLocaleDateString("en-IN",{day:"numeric",month:"short"})}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275pipe=he({name:"timeAgo",type:o,pure:!1,standalone:!0})}}return o})();var De=(()=>{class o{constructor(e){this.http=e,this.chatApi=`${ne.apiUrl}/chats`,this.messageApi=`${ne.apiUrl}/messages`,this.userApi=`${ne.apiUrl}/users`,this.chats=y([]),this.activeChat=y(null),this.messages=y([]),this.typingUsers=y({})}getMyChats(){return this.http.get(this.chatApi).pipe(q(e=>{if(e.success){let t=(e.data.chats||e.data||[]).map(n=>this.normalizeChat(n));this.chats.set(t)}}))}getChats(){return this.getMyChats()}createOrGetChat(e){return this.http.post(`${this.chatApi}/direct`,{targetUserId:e}).pipe(q(t=>{if(t.success){let n=this.normalizeChat(t.data.chat||t.data);this.chats.update(i=>i.find(_=>_._id===n._id)?i.map(_=>_._id===n._id?n:_):[n,...i])}}))}createOrGetDirectChat(e){return this.createOrGetChat(e)}getMessages(e,t=1){return this.http.get(`${this.messageApi}/${e}?page=${t}&limit=50`).pipe(q(n=>{if(n.success){let i=n.data.messages||n.data||[];this.messages.set(i)}}))}sendMessage(e,t){return this.http.post(`${this.messageApi}/${e}`,{content:t})}markAsRead(e){return this.http.post(`${this.messageApi}/${e}/read`,{})}addMessage(e){this.messages.update(t=>[...t,e]),this.chats.update(t=>t.map(n=>n._id===e.chat?S(k({},n),{lastMessage:e,lastMessageText:e.content,lastActivity:e.createdAt}):n))}getUsers(){return this.http.get(this.userApi)}searchUsers(e){return this.http.get(`${this.userApi}/search?q=${encodeURIComponent(e)}`)}setTyping(e,t,n){this.typingUsers.update(i=>{let l=i[e]||[];return n?S(k({},i),{[e]:[...new Set([...l,t])]}):S(k({},i),{[e]:l.filter(_=>_!==t)})})}normalizeChat(e){let t=(e.members||e.participants||[]).map(n=>({user:n.user||n,role:n.role||"member",joinedAt:n.joinedAt||e.createdAt}));return S(k({},e),{members:t,lastMessageText:e.lastMessageText||e.lastMessage?.content||"",unreadCount:e.unreadCount||e.unread||0})}getChatDisplayName(e,t){return e.type==="group"?e.name||"Group":this.getChatOtherUser(e,t)?.name||"Unknown"}getChatOtherUser(e,t){return(e.members||[]).find(l=>(typeof l.user=="object"?l.user._id:l.user)!==t)?.user||null}getAvatarColor(e){let t=["#6C63FF","#FF6B9D","#00D4FF","#00E5A0","#FFB800","#FF6B6B","#8B5CF6","#06B6D4"],n=0;for(let i of e)n=i.charCodeAt(0)+((n<<5)-n);return t[Math.abs(n)%t.length]}getInitials(e){return e.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2)}static{this.\u0275fac=function(t){return new(t||o)(G(Se))}}static{this.\u0275prov=L({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var et=["msgsEl"],tt=["anchor"],nt=["msgInp"],ce=(o,d)=>d._id,it=(o,d)=>d.date,ot=(o,d)=>d.emoji,at=()=>[1,2,3,4];function rt(o,d){if(o&1){let e=M();a(0,"button",32),x("click",function(){u(e);let n=p();return g(n.sq="")}),c(1,"\u2715"),r()}}function st(o,d){o&1&&(a(0,"div",37),m(1,"div",41),r())}function lt(o,d){if(o&1){let e=M();a(0,"div",42),x("click",function(){let n=u(e).$implicit,i=p(2);return g(i.openChat(n._id,n.name))}),a(1,"div",43),c(2),r(),a(3,"div",44)(4,"span",45),c(5),r(),a(6,"span",46),c(7),r()(),m(8,"div",47),r()}if(o&2){let e=d.$implicit,t=p(2);s(),T("background",t.avatarColor(e.name)),s(),h(t.initials(e.name)),s(3),h(e.name),s(2),h(e.email),s(),w("online",e.status==="online")}}function ct(o,d){if(o&1&&(a(0,"div",39),c(1),r()),o&2){let e=p(2);s(),B('No users found for "',e.pq,'"')}}function dt(o,d){o&1&&(a(0,"div",40),c(1,"Type a name or email to search"),r())}function pt(o,d){if(o&1){let e=M();a(0,"div",28)(1,"div",33)(2,"span"),c(3,"New Conversation"),r(),a(4,"button",34),x("click",function(){u(e);let n=p();return n.showPeople.set(!1),n.pq="",g(n.people.set([]))}),c(5,"\u2715"),r()(),a(6,"div",35)(7,"input",36),X("ngModelChange",function(n){u(e);let i=p();return Z(i.pq,n)||(i.pq=n),g(n)}),x("ngModelChange",function(n){u(e);let i=p();return g(i.findPeople(n))}),r()(),C(8,st,2,0,"div",37),I(9,lt,9,7,"div",38,ce),C(11,ct,2,1,"div",39)(12,dt,2,0,"div",40),r()}if(o&2){let e=p();s(7),Y("ngModel",e.pq),s(),f(8,e.searching()?8:-1),s(),j(e.people()),s(2),f(11,!e.searching()&&e.pq&&e.people().length===0?11:-1),s(),f(12,e.pq?-1:12)}}function mt(o,d){o&1&&(a(0,"div",48),m(1,"div",49),a(2,"div",50),m(3,"div",51)(4,"div",52),r()())}function ht(o,d){o&1&&I(0,mt,5,0,"div",48,Q),o&2&&j(ve(0,at))}function ut(o,d){if(o&1){let e=M();a(0,"div",53)(1,"div",54),c(2,"\u{1F4AC}"),r(),a(3,"p"),c(4,"No conversations yet"),r(),a(5,"button",55),x("click",function(){u(e);let n=p();return g(n.showPeople.set(!0))}),c(6,"Start chatting"),r()()}}function gt(o,d){o&1&&(a(0,"em"),c(1,"typing..."),r())}function ft(o,d){if(o&1&&c(0),o&2){let e=p().$implicit,t=p(2);h(t.preview(e))}}function xt(o,d){if(o&1&&(a(0,"span",66),c(1),r()),o&2){let e=p().$implicit;s(),h(e.unreadCount)}}function _t(o,d){if(o&1){let e=M();a(0,"div",57),x("click",function(){let n=u(e).$implicit,i=p(2);return g(i.pick(n))}),a(1,"div",58),c(2),m(3,"span",59),r(),a(4,"div",60)(5,"div",61)(6,"span",62),c(7),r(),a(8,"span",63),c(9),K(10,"timeAgo"),r()(),a(11,"div",64)(12,"span",65),C(13,gt,2,0,"em")(14,ft,1,1),r(),C(15,xt,2,1,"span",66),r()()()}if(o&2){let e,t=d.$implicit,n=p(2);w("active",((e=n.activeChat())==null?null:e._id)===t._id),s(),T("background",n.avatarColor(n.chatName(t))),s(),B(" ",n.initials(n.chatName(t))," "),s(),w("online",n.chatStatus(t)==="online"),s(4),h(n.chatName(t)),s(2),h(be(10,13,t.lastMessage==null?null:t.lastMessage.createdAt)),s(3),w("unread",n.hasUnread(t)),s(),f(13,n.isTypingIn(t._id)?13:14),s(2),f(15,n.hasUnread(t)?15:-1)}}function Ct(o,d){if(o&1&&I(0,_t,16,15,"div",56,ce),o&2){let e=p();j(e.filteredChats())}}function vt(o,d){if(o&1){let e=M();a(0,"div",31)(1,"div",67),m(2,"div",68)(3,"div",69),a(4,"div",70),c(5,"S"),r()(),a(6,"h2"),c(7,"Welcome to Saylo"),r(),a(8,"p"),c(9,"Select a conversation or start a new one"),r(),a(10,"button",55),x("click",function(){u(e);let n=p();return g(n.showPeople.set(!0))}),v(),a(11,"svg",71),m(12,"path",12),r(),c(13," New Conversation "),r()()}}function bt(o,d){if(o&1){let e=M();a(0,"button",96),x("click",function(){u(e);let n=p(2);return g(n.chatSvc.activeChat.set(null))}),v(),a(1,"svg",97),m(2,"path",98),r()()}}function yt(o,d){o&1&&(a(0,"span",78),m(1,"span",99)(2,"span",99)(3,"span",99),c(4," typing... "),r())}function wt(o,d){if(o&1&&(m(0,"span",100),c(1)),o&2){let e=p(2);w("online",e.chatStatus(e.activeChat())==="online"),s(),B(" ",e.chatStatusTxt(e.activeChat())," ")}}function kt(o,d){o&1&&(a(0,"div",85),m(1,"div",41),r())}function St(o,d){if(o&1&&(a(0,"div",112),c(1),r()),o&2){let e=p().$implicit,t=p(3);T("background",t.avatarColor(e.sender.name)),s(),h(t.initials(e.sender.name))}}function Mt(o,d){if(o&1&&(a(0,"div",113)(1,"span",114),c(2),r(),a(3,"span",115),c(4),K(5,"slice"),r()()),o&2){let e=p().$implicit,t=p(3);w("out",t.isOut(e)),s(2),h(e.replyTo.sender==null?null:e.replyTo.sender.name),s(2),h(se(5,4,e.replyTo.content,0,60))}}function Ot(o,d){o&1&&(a(0,"span",107),c(1,"\u{1F6AB} Message deleted"),r())}function Pt(o,d){if(o&1&&(a(0,"span",116),c(1),r()),o&2){let e=p().$implicit;s(),h(e.content)}}function Tt(o,d){o&1&&(v(),m(0,"path",120))}function Et(o,d){if(o&1&&(a(0,"span",117),v(),a(1,"svg",118),m(2,"path",119),C(3,Tt,1,0,":svg:path",120),r()()),o&2){let e=p().$implicit,t=p(3);w("read",t.isRead(e)),s(3),f(3,t.isRead(e)?3:-1)}}function Vt(o,d){if(o&1){let e=M();a(0,"button",123),x("click",function(){let n=u(e).$implicit,i=p(2).$implicit,l=p(3);return g(l.react(i,n.emoji))}),c(1),r()}if(o&2){let e=d.$implicit;s(),Ce("",e.emoji," ",e.count,"")}}function zt(o,d){if(o&1&&(a(0,"div",121),I(1,Vt,2,2,"button",122,ot),r()),o&2){let e=p().$implicit,t=p(3);w("out",t.isOut(e)),s(),j(t.groupReacts(e))}}function It(o,d){if(o&1){let e=M();a(0,"div",86),C(1,St,2,3,"div",103),a(2,"div",104),C(3,Mt,6,8,"div",105),a(4,"div",106),x("dblclick",function(){let n=u(e).$implicit,i=p(3);return g(i.setReply(n))}),C(5,Ot,2,0,"span",107)(6,Pt,2,1),a(7,"div",108)(8,"span",109),c(9),r(),C(10,Et,4,3,"span",110),r()(),C(11,zt,3,2,"div",111),r()()}if(o&2){let e=d.$implicit,t=p(3);w("out",t.isOut(e)),s(),f(1,t.isOut(e)?-1:1),s(2),f(3,e.replyTo?3:-1),s(),w("out",t.isOut(e))("inc",!t.isOut(e))("deleted",e.isDeleted),s(),f(5,e.isDeleted?5:6),s(4),h(t.fmtTime(e.createdAt)),s(),f(10,t.isOut(e)?10:-1),s(),f(11,e.reactions.length>0?11:-1)}}function jt(o,d){if(o&1&&(a(0,"div",101)(1,"span"),c(2),r()(),I(3,It,12,14,"div",102,ce)),o&2){let e=d.$implicit;s(2),h(e.date),s(),j(e.messages)}}function At(o,d){o&1&&(a(0,"div",86)(1,"div",124),c(2,"\u{1F4AC}"),r(),a(3,"div",125),m(4,"span",99)(5,"span",99)(6,"span",99),r()())}function Dt(o,d){if(o&1){let e=M();a(0,"div",87),m(1,"div",126),a(2,"div",127)(3,"span",128),c(4),r(),a(5,"span",129),c(6),K(7,"slice"),r()(),a(8,"button",34),x("click",function(){u(e);let n=p(2);return g(n.replyTo.set(null))}),c(9,"\u2715"),r()()}if(o&2){let e=p(2);s(4),B("\u21A9 ",e.replyTo().sender.name,""),s(2),h(se(7,2,e.replyTo().content,0,80))}}function Ft(o,d){if(o&1){let e=M();a(0,"header",72),C(1,bt,3,0,"button",73),a(2,"div",74),c(3),r(),a(4,"div",75)(5,"div",76),c(6),r(),a(7,"div",77),C(8,yt,5,0,"span",78)(9,wt,2,3),r()(),a(10,"div",79)(11,"button",80),x("click",function(){u(e);let n=p();return g(n.callAudio())}),v(),a(12,"svg",14),m(13,"path",81),r()(),P(),a(14,"button",82),x("click",function(){u(e);let n=p();return g(n.callVideo())}),v(),a(15,"svg",14),m(16,"path",83),r()()()(),P(),a(17,"div",84,0),x("scroll",function(n){u(e);let i=p();return g(i.onScroll(n))}),C(19,kt,2,0,"div",85),I(20,jt,5,1,null,null,it),C(22,At,7,0,"div",86),m(23,"div",null,1),r(),C(25,Dt,10,6,"div",87),a(26,"div",88)(27,"div",89)(28,"button",90),v(),a(29,"svg",14),m(30,"path",91),r()(),P(),a(31,"input",92,2),X("ngModelChange",function(n){u(e);let i=p();return Z(i.txt,n)||(i.txt=n),g(n)}),x("ngModelChange",function(){u(e);let n=p();return g(n.onType())})("keydown.enter",function(){u(e);let n=p();return g(n.send())})("focus",function(){u(e);let n=p();return g(n.inpFocus.set(!0))})("blur",function(){u(e);let n=p();return n.inpFocus.set(!1),g(n.stopType())}),r(),a(33,"button",93),c(34,"\u{1F60A}"),r()(),a(35,"button",94),x("click",function(){u(e);let n=p();return g(n.send())}),v(),a(36,"svg",11),m(37,"path",95),r()()()}if(o&2){let e=p();s(),f(1,e.mobile()?1:-1),s(),T("background",e.avatarColor(e.chatName(e.activeChat()))),s(),B(" ",e.initials(e.chatName(e.activeChat()))," "),s(3),h(e.chatName(e.activeChat())),s(2),f(8,e.isTypingIn(e.activeChat()._id)?8:9),s(11),f(19,e.loadingMsgs()?19:-1),s(),j(e.msgGroups()),s(2),f(22,e.isTypingIn(e.activeChat()._id)?22:-1),s(3),f(25,e.replyTo()?25:-1),s(2),w("focused",e.inpFocus()),s(4),_e("placeholder","Message "+e.chatName(e.activeChat())+"..."),Y("ngModel",e.txt),s(4),w("active",e.txt.trim())}}var bn=(()=>{class o{constructor(e,t,n,i,l,_){this.auth=e,this.socket=t,this.chatSvc=n,this.callSvc=i,this.snack=l,this.zone=_,this.destroy$=new U,this.typingTimer=null,this.doScroll=!0,this.me=this.auth.currentUser,this.activeChat=this.chatSvc.activeChat,this.messages=this.chatSvc.messages,this.chats=this.chatSvc.chats,this.typing=this.chatSvc.typingUsers,this.loading=y(!1),this.loadingMsgs=y(!1),this.showPeople=y(!1),this.inpFocus=y(!1),this.searching=y(!1),this.replyTo=y(null),this.people=y([]),this.sq="",this.pq="",this.txt="",this.filteredChats=ee(()=>{let O=this.chats();return this.sq&&(O=O.filter(z=>this.chatName(z).toLowerCase().includes(this.sq.toLowerCase()))),O}),this.msgGroups=ee(()=>{let O=this.messages();if(!O.length)return[];let z=[],R="",$=[];return O.forEach(re=>{let de=this.fmtDate(re.createdAt);de!==R?($.length&&z.push({date:R,messages:$}),R=de,$=[k({},re)]):$.push(k({},re))}),$.length&&z.push({date:R,messages:$}),z})}ngOnInit(){this.socket.connect(this.me()?._id||""),this.loading.set(!0),this.chatSvc.getMyChats().pipe(b(this.destroy$)).subscribe({next:()=>this.loading.set(!1),error:()=>this.loading.set(!1)}),this.listenSocket()}ngAfterViewChecked(){this.doScroll&&this.scrollBottom()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.socket.disconnect()}onResize(){}mobile(){return window.innerWidth<=768}pick(e){this.activeChat()?._id!==e._id&&(this.activeChat()&&this.socket.leaveChat(this.activeChat()._id),this.chatSvc.activeChat.set(e),this.chatSvc.messages.set([]),this.replyTo.set(null),this.doScroll=!0,this.loadingMsgs.set(!0),this.chatSvc.getMessages(e._id).pipe(b(this.destroy$)).subscribe({next:()=>{this.loadingMsgs.set(!1),this.socket.joinChat(e._id),this.doScroll=!0},error:()=>this.loadingMsgs.set(!1)}))}listenSocket(){this.socket.on("message:new").pipe(b(this.destroy$)).subscribe(({message:e})=>{this.zone.run(()=>{e.chat===this.activeChat()?._id?(e.sender._id===this.me()?._id&&this.chatSvc.messages.update(t=>t.filter(n=>!n._id.startsWith("tmp_"))),this.chatSvc.addMessage(e),this.doScroll=!0):this.chatSvc.chats.update(t=>t.map(n=>n._id===e.chat?S(k({},n),{lastMessage:e,unreadCount:(n.unreadCount||0)+1}):n))})}),this.socket.on("typing:start").pipe(b(this.destroy$)).subscribe(({userId:e,chatId:t})=>{e!==this.me()?._id&&this.chatSvc.setTyping(t,e,!0)}),this.socket.on("typing:stop").pipe(b(this.destroy$)).subscribe(({userId:e,chatId:t})=>{this.chatSvc.setTyping(t,e,!1)}),this.socket.on("user:online").pipe(b(this.destroy$)).subscribe(({userId:e})=>{this.zone.run(()=>{this.chatSvc.chats.update(t=>t.map(n=>S(k({},n),{members:n.members.map(i=>i.user._id===e?S(k({},i),{user:S(k({},i.user),{status:"online"})}):i)})))})}),this.socket.on("user:offline").pipe(b(this.destroy$)).subscribe(({userId:e})=>{this.zone.run(()=>{this.chatSvc.chats.update(t=>t.map(n=>S(k({},n),{members:n.members.map(i=>i.user._id===e?S(k({},i),{user:S(k({},i.user),{status:"offline"})}):i)})))})}),this.socket.on("users:online-list").pipe(b(this.destroy$)).subscribe(({userIds:e})=>{this.zone.run(()=>{this.chatSvc.chats.update(t=>t.map(n=>S(k({},n),{members:n.members.map(i=>e.includes(i.user._id)?S(k({},i),{user:S(k({},i.user),{status:"online"})}):i)})))})})}send(){let e=this.txt.trim();if(!e||!this.activeChat())return;let t=this.me(),n=this.activeChat(),i={_id:"tmp_"+Date.now(),chat:n._id,sender:{_id:t._id,name:t.name,email:t.email||"",avatar:t.avatar,status:"online"},type:"text",content:e,replyTo:this.replyTo(),reactions:[],readBy:[],isDeleted:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};this.chatSvc.addMessage(i),this.socket.sendMessage(n._id,e),this.txt="",this.replyTo.set(null),this.doScroll=!0,this.stopType()}onType(){this.activeChat()&&(this.socket.sendTypingStart(this.activeChat()._id,this.me()?._id||"",this.me()?.name||""),clearTimeout(this.typingTimer),this.typingTimer=setTimeout(()=>this.stopType(),2e3))}stopType(){this.activeChat()&&(clearTimeout(this.typingTimer),this.socket.sendTypingStop(this.activeChat()._id,this.me()?._id||""))}setReply(e){e.isDeleted||this.replyTo.set(e)}react(e,t){this.activeChat()&&this.socket.emit("message:react",{messageId:e._id,emoji:t,chatId:this.activeChat()._id})}findPeople(e){if(!e.trim()){this.people.set([]);return}this.searching.set(!0),this.chatSvc.searchUsers(e).pipe(b(this.destroy$)).subscribe({next:t=>{this.people.set(t.data?.users||[]),this.searching.set(!1)},error:()=>this.searching.set(!1)})}openChat(e,t){this.chatSvc.createOrGetChat(e).pipe(b(this.destroy$)).subscribe({next:n=>{this.showPeople.set(!1),this.people.set([]),this.pq="";let i=n.data?.chat||n.data;i&&this.pick(this.chatSvc.chats().find(l=>l._id===i._id)||i)},error:()=>this.snack.open("Failed to open chat","\u2715",{duration:3e3})})}callAudio(){let e=this.getOtherUser();!e||!this.activeChat()||this.callSvc.startCall(this.activeChat()._id,e._id,e.name,"audio")}callVideo(){let e=this.getOtherUser();!e||!this.activeChat()||this.callSvc.startCall(this.activeChat()._id,e._id,e.name,"video")}getOtherUser(){let e=this.activeChat();return e?this.chatSvc.getChatOtherUser(e,this.me()?._id||""):null}logout(){this.auth.logout()}onScroll(e){let t=e.target;this.doScroll=t.scrollHeight-t.scrollTop-t.clientHeight<120}scrollBottom(){try{this.anchor?.nativeElement?.scrollIntoView({behavior:"smooth"})}catch{}}isOut(e){return e.sender._id===this.me()?._id}isRead(e){return e.readBy.some(t=>(typeof t.user=="object"?t.user._id:t.user)!==this.me()?._id)}isTypingIn(e){return(this.typing()[e]||[]).length>0}hasUnread(e){return(e.unreadCount||0)>0}chatName(e){return this.chatSvc.getChatDisplayName(e,this.me()?._id||"")}chatStatus(e){return e.type==="group"?"online":this.chatSvc.getChatOtherUser(e,this.me()?._id||"")?.status||"offline"}chatStatusTxt(e){return e.type==="group"?`${e.members.length} members`:this.chatStatus(e)==="online"?"Active now":"Offline"}preview(e){return e.lastMessage?e.lastMessage.isDeleted?"\u{1F6AB} Message deleted":(e.lastMessage.sender._id===this.me()?._id?"You: ":"")+(e.lastMessage.content?.slice(0,42)||""):"No messages yet"}avatarColor(e){return this.chatSvc.getAvatarColor(e)}initials(e){return this.chatSvc.getInitials(e)}groupReacts(e){let t={};return e.reactions.forEach(n=>{t[n.emoji]=(t[n.emoji]||0)+1}),Object.entries(t).map(([n,i])=>({emoji:n,count:i}))}fmtTime(e){return new Date(e).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",hour12:!0})}fmtDate(e){let t=new Date(e),n=new Date,i=new Date(n);return i.setDate(n.getDate()-1),t.toDateString()===n.toDateString()?"Today":t.toDateString()===i.toDateString()?"Yesterday":t.toLocaleDateString("en-IN",{day:"numeric",month:"long",year:"numeric"})}static{this.\u0275fac=function(t){return new(t||o)(E(Me),E(ie),E(De),E(ae),E(Ve),E(N))}}static{this.\u0275cmp=H({type:o,selectors:[["app-chat"]],viewQuery:function(t,n){if(t&1&&(A(et,5),A(tt,5),A(nt,5)),t&2){let i;D(i=F())&&(n.msgsEl=i.first),D(i=F())&&(n.anchor=i.first),D(i=F())&&(n.msgInp=i.first)}},hostBindings:function(t,n){t&1&&x("resize",function(){return n.onResize()},!1,xe)},standalone:!0,features:[J],decls:39,vars:13,consts:[["msgsEl",""],["anchor",""],["msgInp",""],[1,"shell"],[1,"sidebar"],[1,"sb-head"],[1,"sb-brand"],[1,"brand-logo"],[1,"brand-name"],[1,"sb-actions"],["title","New chat",1,"icon-btn",3,"click"],["width","18","height","18","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2.5"],["stroke-linecap","round","stroke-linejoin","round","d","M12 4v16m8-8H4"],["title","Logout",1,"icon-btn",3,"click"],["width","18","height","18","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2"],["stroke-linecap","round","stroke-linejoin","round","d","M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"],[1,"my-profile"],[1,"my-av"],[1,"my-info"],[1,"my-name"],[1,"my-status"],[1,"sb-search"],[1,"search-box"],["width","14","height","14","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2.5"],["cx","11","cy","11","r","8"],["stroke-linecap","round","d","M21 21l-4.35-4.35"],["placeholder","Search conversations...",3,"ngModelChange","ngModel"],[1,"clr-btn"],[1,"people-panel"],[1,"sb-list"],[1,"main"],[1,"welcome"],[1,"clr-btn",3,"click"],[1,"pp-head"],[1,"icon-btn","sm",3,"click"],[1,"pp-search"],["placeholder","Search by name or email...","autofocus","",1,"pp-input",3,"ngModelChange","ngModel"],[1,"pp-loading"],[1,"pp-user"],[1,"pp-empty"],[1,"pp-hint"],[1,"spin"],[1,"pp-user",3,"click"],[1,"pp-av"],[1,"pp-info"],[1,"pp-name"],[1,"pp-email"],[1,"pp-status-dot"],[1,"ske-item"],[1,"ske-av","skeleton"],[1,"ske-body"],[1,"skeleton",2,"height","11px","width","50%","border-radius","6px"],[1,"skeleton",2,"height","10px","width","75%","border-radius","6px","margin-top","6px"],[1,"sb-empty"],[1,"empty-icon"],[1,"start-btn",3,"click"],[1,"ci",3,"active"],[1,"ci",3,"click"],[1,"ci-av"],[1,"ci-dot"],[1,"ci-body"],[1,"ci-top"],[1,"ci-name"],[1,"ci-time"],[1,"ci-bottom"],[1,"ci-preview"],[1,"ci-badge"],[1,"welcome-art"],[1,"w-circle","c1"],[1,"w-circle","c2"],[1,"w-logo"],["width","16","height","16","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2.5"],[1,"chat-header"],[1,"icon-btn"],[1,"header-av"],[1,"header-info"],[1,"header-name"],[1,"header-status"],[1,"typing-status"],[1,"header-calls"],["title","Audio Call",1,"call-btn","audio",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"],["title","Video Call",1,"call-btn","video",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M15 10l4.553-2.276A1 1 0 0121 8.723v6.554a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"],[1,"msgs",3,"scroll"],[1,"msgs-load"],[1,"msg-row"],[1,"reply-strip"],[1,"input-bar"],[1,"input-wrap"],["title","Attach",1,"inp-icon-btn"],["stroke-linecap","round","stroke-linejoin","round","d","M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"],["type","text",1,"msg-input",3,"ngModelChange","keydown.enter","focus","blur","placeholder","ngModel"],["title","Emoji",1,"inp-icon-btn"],[1,"send-btn",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M12 19l9 2-9-18-9 18 9-2zm0 0v-8"],[1,"icon-btn",3,"click"],["width","20","height","20","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2.5"],["stroke-linecap","round","stroke-linejoin","round","d","M15 19l-7-7 7-7"],[1,"td"],[1,"status-dot"],[1,"date-sep"],[1,"msg-row",3,"out"],[1,"msg-av",3,"background"],[1,"msg-wrap"],[1,"reply-preview",3,"out"],[1,"bubble",3,"dblclick"],[1,"deleted-text"],[1,"bubble-meta"],[1,"msg-time"],[1,"read-tick",3,"read"],[1,"reactions",3,"out"],[1,"msg-av"],[1,"reply-preview"],[1,"reply-name"],[1,"reply-text"],[1,"bubble-text"],[1,"read-tick"],["width","16","height","10","viewBox","0 0 16 10","fill","none"],["d","M1 5L5 9L15 1","stroke","currentColor","stroke-width","1.8","stroke-linecap","round"],["d","M6 5L10 9L15 3","stroke","currentColor","stroke-width","1.8","stroke-linecap","round","opacity",".7"],[1,"reactions"],[1,"react-pill"],[1,"react-pill",3,"click"],[1,"msg-av",2,"background","#E8E1D9"],[1,"typing-bubble"],[1,"reply-bar"],[1,"reply-strip-info"],[1,"reply-strip-name"],[1,"reply-strip-text"]],template:function(t,n){if(t&1&&(a(0,"div",3)(1,"aside",4)(2,"div",5)(3,"div",6)(4,"div",7),c(5,"S"),r(),a(6,"span",8),c(7,"Saylo"),r()(),a(8,"div",9)(9,"button",10),x("click",function(){return n.showPeople.set(!0)}),v(),a(10,"svg",11),m(11,"path",12),r()(),P(),a(12,"button",13),x("click",function(){return n.logout()}),v(),a(13,"svg",14),m(14,"path",15),r()()()(),P(),a(15,"div",16)(16,"div",17),c(17),r(),a(18,"div",18)(19,"span",19),c(20),r(),a(21,"span",20),c(22,"\u{1F7E2} Active"),r()()(),a(23,"div",21)(24,"div",22),v(),a(25,"svg",23),m(26,"circle",24)(27,"path",25),r(),P(),a(28,"input",26),X("ngModelChange",function(l){return Z(n.sq,l)||(n.sq=l),l}),r(),C(29,rt,2,0,"button",27),r()(),C(30,pt,13,4,"div",28),a(31,"div",29),C(32,ht,2,1)(33,ut,7,0)(34,Ct,2,0),r()(),a(35,"main",30),C(36,vt,14,0,"div",31)(37,Ft,38,15),r(),m(38,"app-call"),r()),t&2){let i,l,_;s(),w("hidden",n.activeChat()&&n.mobile()),s(15),T("background",n.avatarColor(((i=n.me())==null?null:i.name)||"U")),s(),h(n.initials(((l=n.me())==null?null:l.name)||"U")),s(3),h((_=n.me())==null?null:_.name),s(8),Y("ngModel",n.sq),s(),f(29,n.sq?29:-1),s(),f(30,n.showPeople()?30:-1),s(2),f(32,n.loading()?32:n.filteredChats().length===0?33:34),s(3),w("show",n.activeChat()||!n.mobile()),s(),f(36,n.activeChat()?37:36)}},dependencies:[te,ke,Ee,Oe,Pe,Te,Ae,ze,je],styles:['[_nghost-%COMP%]{display:flex;height:100vh;overflow:hidden}.shell[_ngcontent-%COMP%]{display:grid;grid-template-columns:320px 1fr;width:100vw;height:100vh;overflow:hidden;background:var(--bg-primary);font-family:var(--font-body)}.sidebar[_ngcontent-%COMP%]{background:var(--bg-secondary);border-right:1px solid var(--border-light);display:flex;flex-direction:column;overflow:hidden;box-shadow:var(--shadow-sm)}.sb-head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:16px 16px 12px;border-bottom:1px solid var(--border-light)}.sb-brand[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.brand-logo[_ngcontent-%COMP%]{width:36px;height:36px;background:var(--grad-brand);border-radius:10px;display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-weight:700;font-size:16px;color:#fff;box-shadow:0 4px 12px #7c6af54d}.brand-name[_ngcontent-%COMP%]{font-family:var(--font-display);font-size:20px;font-weight:700;color:var(--text-primary)}.sb-actions[_ngcontent-%COMP%]{display:flex;gap:4px}.icon-btn[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:none;border:none;cursor:pointer;color:var(--text-muted);transition:all .15s}.icon-btn[_ngcontent-%COMP%]:hover{background:var(--bg-hover);color:var(--accent-primary)}.icon-btn.sm[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:8px}.my-profile[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:12px 16px;background:var(--bg-elevated);border-bottom:1px solid var(--border-light)}.my-av[_ngcontent-%COMP%]{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-weight:700;font-size:13px;color:#fff;flex-shrink:0}.my-name[_ngcontent-%COMP%]{display:block;font-size:13.5px;font-weight:600;color:var(--text-primary)}.my-status[_ngcontent-%COMP%]{font-size:11px;color:var(--text-muted)}.sb-search[_ngcontent-%COMP%]{padding:12px 12px 8px}.search-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:var(--bg-elevated);border:1.5px solid var(--border-light);border-radius:12px;padding:9px 12px;transition:border-color .15s}.search-box[_ngcontent-%COMP%]:focus-within{border-color:var(--accent-primary)}.search-box[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--text-muted);flex-shrink:0}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;background:none;border:none;outline:none;font-size:13.5px;color:var(--text-primary)}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:var(--text-muted)}.clr-btn[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:var(--text-muted);font-size:11px;min-height:unset;min-width:unset}.people-panel[_ngcontent-%COMP%]{position:absolute;inset:0;background:var(--bg-secondary);z-index:50;display:flex;flex-direction:column;box-shadow:var(--shadow-lg)}.pp-head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid var(--border-light);font-family:var(--font-display);font-size:16px;font-weight:600}.pp-search[_ngcontent-%COMP%]{padding:12px 16px}.pp-input[_ngcontent-%COMP%]{width:100%;padding:10px 14px;background:var(--bg-elevated);border:1.5px solid var(--border-light);border-radius:12px;font-size:14px;color:var(--text-primary);transition:border-color .15s}.pp-input[_ngcontent-%COMP%]:focus{border-color:var(--accent-primary)}.pp-input[_ngcontent-%COMP%]::placeholder{color:var(--text-muted)}.pp-loading[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:20px}.pp-user[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 16px;cursor:pointer;border-bottom:1px solid var(--border-light);transition:background .12s}.pp-user[_ngcontent-%COMP%]:hover{background:var(--bg-hover)}.pp-av[_ngcontent-%COMP%]{width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-weight:700;font-size:14px;color:#fff;flex-shrink:0}.pp-info[_ngcontent-%COMP%]{flex:1}.pp-name[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:600}.pp-email[_ngcontent-%COMP%]{font-size:12px;color:var(--text-muted)}.pp-status-dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;background:var(--text-muted);border:2px solid #fff}.pp-status-dot.online[_ngcontent-%COMP%]{background:var(--accent-green)}.pp-empty[_ngcontent-%COMP%], .pp-hint[_ngcontent-%COMP%]{padding:24px;text-align:center;color:var(--text-muted);font-size:13px}.sb-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:6px}.ske-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px}.ske-av[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;flex-shrink:0}.ske-body[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:6px}.skeleton[_ngcontent-%COMP%]{background:linear-gradient(90deg,var(--bg-elevated) 25%,var(--bg-hover) 50%,var(--bg-elevated) 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_skelPulse 1.4s ease infinite}@keyframes _ngcontent-%COMP%_skelPulse{0%{background-position:200% 0}to{background-position:-200% 0}}.sb-empty[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:10px;text-align:center;color:var(--text-muted)}.empty-icon[_ngcontent-%COMP%]{font-size:40px}.start-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 20px;background:var(--grad-brand);color:#fff;border:none;border-radius:12px;font-family:var(--font-body);font-size:13.5px;font-weight:600;cursor:pointer;transition:all .2s;box-shadow:0 4px 12px #7c6af54d;margin-top:8px;min-height:unset}.start-btn[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 6px 20px #7c6af566}.ci[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px;border-radius:14px;cursor:pointer;transition:background .12s;margin-bottom:2px}.ci[_ngcontent-%COMP%]:hover{background:var(--bg-hover)}.ci.active[_ngcontent-%COMP%]{background:#7c6af51a}.ci-av[_ngcontent-%COMP%]{width:46px;height:46px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-weight:700;font-size:14px;color:#fff;flex-shrink:0;position:relative}.ci-dot[_ngcontent-%COMP%]{position:absolute;bottom:1px;right:1px;width:11px;height:11px;border-radius:50%;background:var(--text-muted);border:2px solid var(--bg-secondary)}.ci-dot.online[_ngcontent-%COMP%]{background:var(--accent-green)}.ci-body[_ngcontent-%COMP%]{flex:1;min-width:0}.ci-top[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:3px}.ci-name[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:var(--text-primary)}.ci-time[_ngcontent-%COMP%]{font-size:10.5px;color:var(--text-muted);flex-shrink:0}.ci-bottom[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.ci-preview[_ngcontent-%COMP%]{font-size:12.5px;color:var(--text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1}.ci-preview.unread[_ngcontent-%COMP%]{color:var(--text-secondary);font-weight:500}.ci-badge[_ngcontent-%COMP%]{min-width:18px;height:18px;padding:0 5px;background:var(--accent-primary);border-radius:9px;font-size:10px;font-weight:700;color:#fff;display:flex;align-items:center;justify-content:center;flex-shrink:0}.main[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;overflow:hidden;background:var(--bg-primary)}.welcome[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;text-align:center;padding:20px}.welcome-art[_ngcontent-%COMP%]{position:relative;width:90px;height:90px;margin-bottom:8px}.w-circle[_ngcontent-%COMP%]{position:absolute;border-radius:50%}.c1[_ngcontent-%COMP%]{width:80px;height:80px;background:#7c6af51f;top:5px;left:5px;animation:_ngcontent-%COMP%_pulse 2s ease infinite}.c2[_ngcontent-%COMP%]{width:60px;height:60px;background:#f5a6231a;top:15px;left:15px;animation:_ngcontent-%COMP%_pulse 2s ease infinite .5s}.w-logo[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:52px;height:52px;background:var(--grad-brand);border-radius:16px;display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-weight:700;font-size:22px;color:#fff;box-shadow:0 6px 20px #7c6af559}.welcome[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:var(--font-display);font-size:26px;font-weight:700;color:var(--text-primary)}.welcome[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-muted);font-size:14px}.chat-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px 20px;background:var(--bg-secondary);border-bottom:1px solid var(--border-light);box-shadow:var(--shadow-sm);flex-shrink:0;min-height:66px}.header-av[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-weight:700;font-size:13px;color:#fff;flex-shrink:0}.header-info[_ngcontent-%COMP%]{flex:1}.header-name[_ngcontent-%COMP%]{font-size:15px;font-weight:700;color:var(--text-primary)}.header-status[_ngcontent-%COMP%]{font-size:12px;color:var(--text-muted);display:flex;align-items:center;gap:5px;margin-top:2px}.status-dot[_ngcontent-%COMP%]{width:7px;height:7px;border-radius:50%;background:var(--text-muted);display:inline-block}.status-dot.online[_ngcontent-%COMP%]{background:var(--accent-green)}.typing-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:var(--accent-primary);font-style:italic}.header-calls[_ngcontent-%COMP%]{display:flex;gap:8px}.call-btn[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;border:none;cursor:pointer;transition:all .2s}.call-btn.audio[_ngcontent-%COMP%]{background:#2ecc711f;color:#2ecc71}.call-btn.audio[_ngcontent-%COMP%]:hover{background:var(--grad-green);color:#fff;box-shadow:0 4px 14px #2ecc7159;transform:translateY(-1px)}.call-btn.video[_ngcontent-%COMP%]{background:#3498db1f;color:#3498db}.call-btn.video[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#3498db,#2980b9);color:#fff;box-shadow:0 4px 14px #3498db59;transform:translateY(-1px)}.msgs[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:16px 20px;display:flex;flex-direction:column;gap:4px;min-height:0}.msgs-load[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:30px}.date-sep[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:12px 0;flex-shrink:0}.date-sep[_ngcontent-%COMP%]:before, .date-sep[_ngcontent-%COMP%]:after{content:"";flex:1;height:1px;background:var(--border-light)}.date-sep[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:11px;color:var(--text-muted);font-weight:500;padding:3px 12px;background:var(--bg-elevated);border-radius:20px;border:1px solid var(--border-light);white-space:nowrap}.msg-row[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:8px;animation:_ngcontent-%COMP%_fadeUp .2s ease forwards}.msg-row.out[_ngcontent-%COMP%]{flex-direction:row-reverse}.msg-av[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:#fff;font-family:var(--font-display);margin-bottom:2px}.msg-wrap[_ngcontent-%COMP%]{max-width:65%;display:flex;flex-direction:column;gap:3px}.msg-row.out[_ngcontent-%COMP%]   .msg-wrap[_ngcontent-%COMP%]{align-items:flex-end}.reply-preview[_ngcontent-%COMP%]{padding:6px 10px;background:var(--bg-elevated);border-left:3px solid var(--accent-primary);border-radius:8px;margin-bottom:3px}.reply-preview.out[_ngcontent-%COMP%]{border-left-color:#fff6}.reply-name[_ngcontent-%COMP%]{display:block;font-size:10.5px;font-weight:600;color:var(--accent-primary)}.reply-text[_ngcontent-%COMP%]{font-size:11.5px;color:var(--text-muted)}.bubble[_ngcontent-%COMP%]{padding:10px 14px;border-radius:18px;word-break:break-word}.bubble.inc[_ngcontent-%COMP%]{background:var(--bg-secondary);border:1px solid var(--border-light);border-bottom-left-radius:4px;color:var(--text-primary);box-shadow:var(--shadow-sm)}.bubble.out[_ngcontent-%COMP%]{background:var(--grad-brand);color:#fff;border-bottom-right-radius:4px;box-shadow:0 4px 12px #7c6af540}.bubble.deleted[_ngcontent-%COMP%]{opacity:.6}.bubble-text[_ngcontent-%COMP%]{font-size:14px;line-height:1.5}.deleted-text[_ngcontent-%COMP%]{font-size:13px;font-style:italic;opacity:.7}.bubble-meta[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:4px;margin-top:4px}.msg-time[_ngcontent-%COMP%]{font-size:10px;opacity:.65}.bubble.out[_ngcontent-%COMP%]   .msg-time[_ngcontent-%COMP%]{color:#ffffffd9}.read-tick[_ngcontent-%COMP%]{display:flex;align-items:center;color:#ffffffa6}.read-tick.read[_ngcontent-%COMP%]{color:#a8f0d8}.reactions[_ngcontent-%COMP%]{display:flex;gap:4px;flex-wrap:wrap}.reactions.out[_ngcontent-%COMP%]{justify-content:flex-end}.react-pill[_ngcontent-%COMP%]{background:var(--bg-elevated);border:1px solid var(--border-light);border-radius:20px;padding:2px 8px;font-size:12px;cursor:pointer;transition:all .12s;min-height:unset;min-width:unset}.react-pill[_ngcontent-%COMP%]:hover{border-color:var(--accent-primary)}.typing-bubble[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;padding:12px 16px;background:var(--bg-secondary);border:1px solid var(--border-light);border-radius:18px 18px 18px 4px;box-shadow:var(--shadow-sm)}.td[_ngcontent-%COMP%]{width:6px;height:6px;border-radius:50%;background:var(--accent-primary);display:inline-block;animation:_ngcontent-%COMP%_bounce 1.2s ease infinite}.td[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.td[_ngcontent-%COMP%]:nth-child(3){animation-delay:.4s}.reply-strip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px 16px;background:var(--bg-elevated);border-top:1px solid var(--border-light);flex-shrink:0}.reply-bar[_ngcontent-%COMP%]{width:3px;height:32px;background:var(--accent-primary);border-radius:2px;flex-shrink:0}.reply-strip-info[_ngcontent-%COMP%]{flex:1}.reply-strip-name[_ngcontent-%COMP%]{display:block;font-size:11px;font-weight:600;color:var(--accent-primary)}.reply-strip-text[_ngcontent-%COMP%]{font-size:12px;color:var(--text-muted)}.input-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:12px 16px;background:var(--bg-secondary);border-top:1px solid var(--border-light);flex-shrink:0}.input-wrap[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;gap:8px;background:var(--bg-elevated);border:1.5px solid var(--border-light);border-radius:24px;padding:8px 14px;transition:border-color .15s}.input-wrap.focused[_ngcontent-%COMP%]{border-color:var(--accent-primary)}.msg-input[_ngcontent-%COMP%]{flex:1;background:none;border:none;outline:none;font-size:14px;color:var(--text-primary)}.msg-input[_ngcontent-%COMP%]::placeholder{color:var(--text-muted)}.inp-icon-btn[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:var(--text-muted);font-size:16px;display:flex;align-items:center;justify-content:center;transition:color .15s;min-height:unset;min-width:unset;width:28px;height:28px}.inp-icon-btn[_ngcontent-%COMP%]:hover{color:var(--accent-primary)}.send-btn[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:var(--bg-elevated);border:1.5px solid var(--border-light);cursor:pointer;color:var(--text-muted);transition:all .2s cubic-bezier(.34,1.56,.64,1)}.send-btn.active[_ngcontent-%COMP%]{background:var(--grad-brand);border-color:transparent;color:#fff;box-shadow:0 4px 14px #7c6af566}.send-btn.active[_ngcontent-%COMP%]:hover{transform:scale(1.1);box-shadow:0 6px 20px #7c6af580}.spin[_ngcontent-%COMP%]{width:22px;height:22px;border:2.5px solid var(--border-light);border-top-color:var(--accent-primary);border-radius:50%;animation:_ngcontent-%COMP%_spin .7s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_fadeUp{0%{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_bounce{0%,80%,to{transform:translateY(0);opacity:.4}40%{transform:translateY(-6px);opacity:1}}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.4}}@media (max-width: 768px){.shell[_ngcontent-%COMP%]{grid-template-columns:100%!important}.sidebar[_ngcontent-%COMP%]{width:100%;position:absolute;inset:0;z-index:10}.sidebar.hidden[_ngcontent-%COMP%]{display:none}.main[_ngcontent-%COMP%]{position:absolute;inset:0;z-index:10}.main[_ngcontent-%COMP%]:not(.show){display:none}.msgs[_ngcontent-%COMP%]{padding:12px}.msg-wrap[_ngcontent-%COMP%]{max-width:80%}.chat-header[_ngcontent-%COMP%]{padding:10px 14px}.input-bar[_ngcontent-%COMP%]{padding:10px 12px;padding-bottom:calc(10px + env(safe-area-inset-bottom))}.bubble-text[_ngcontent-%COMP%]{font-size:15px}.call-btn[_ngcontent-%COMP%]{width:36px;height:36px}}']})}}return o})();export{bn as ChatComponent};
